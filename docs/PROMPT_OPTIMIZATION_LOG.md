# 提示词优化日志

## 2025-12-29 优化：修复选题灵感重复引用问题

### 问题描述

用户反馈：一篇文章产生了多个选题灵感，这不符合预期。

**期望行为**：
- 一篇文章应该对应一个主要的选题灵感
- 不同的选题灵感应该基于不同的文章

**实际行为**（修复前）：
- AI从一篇文章中提取了3个不同角度的选题灵感
- 所有选题灵感都引用了同一篇文章作为参考

**问题根源**：
提示词中要求"至少有2篇相关文章支撑"，但当只有1篇文章时，AI会从这篇文章中提取多个选题来满足"生成3个选题"的要求。

### 解决方案

#### 1. 明确核心原则

在"任务2：生成选题灵感"部分添加了**重要原则**：

```markdown
**重要原则**：
- 🔑 **每个选题灵感必须基于不同的核心文章**
- 🔑 **一篇文章只能作为一个选题的主要参考**
- 🔑 如果文章总数少于3篇，选题数量相应减少（避免重复）
```

#### 2. 修改选题要求

**修改前**：
```markdown
- 至少有2篇相关文章支撑
```

**修改后**：
```markdown
- 基于至少1篇高质量文章
- ⚠️ 注意：每个选题的核心参考文章必须不同，不能重复使用同一篇文章
```

#### 3. 更新示例

在示例选题中明确标注"核心文章"，并添加说明：

```markdown
⚠️ **注意**：上面3个选题分别基于3篇不同的核心文章，没有重复使用同一篇文章。
```

#### 4. 强化注意事项

在"注意事项"部分添加了更明确的说明：

```markdown
2. **选题灵感**要有创意和实操性，不要泛泛而谈
   - 🔑 **核心原则**：每个选题必须基于不同的核心文章，严禁重复使用同一篇文章
   - 如果文章总数少于3篇，则选题数量相应减少
   - 宁可少而精，也不要为了凑数而重复

4. **避免重复**：
   - 🚨 **最重要**：每个选题灵感必须基于不同的核心文章
   - 如果可选文章数量不足，宁可减少选题数量，也不要重复使用同一篇文章
```

#### 5. 更新JSON输出示例

在输出格式示例中添加了注释：

```json
"inspirations": [
  {
    "title": "灵感标题1",
    "references": [
      {
        "article_title": "核心参考文章A的标题",
        ...
      }
    ]
  },
  {
    "title": "灵感标题2（基于不同的文章）",
    "references": [
      {
        "article_title": "核心参考文章B的标题（不能与文章A相同）",
        ...
      }
    ]
  }
]
```

### 预期效果

#### 场景1：有多篇文章（≥3篇）
- ✅ 生成3个选题灵感
- ✅ 每个选题基于不同的文章
- ✅ 选题之间有明显的主题差异

#### 场景2：只有1-2篇文章
- ✅ 只生成1-2个选题灵感（与文章数量匹配）
- ✅ 不会为了凑数而从同一篇文章提取多个选题
- ✅ 选题质量更高、更聚焦

#### 场景3：文章质量参差不齐
- ✅ 优先选择高质量文章生成选题
- ✅ 宁可少而精，不要勉强凑数

### 测试建议

测试时关注以下几点：

1. **检查references字段**：确保不同选题的核心文章不重复
2. **检查选题数量**：文章少时，选题数量应相应减少
3. **检查选题质量**：不应为了凑够3个而降低标准

### 相关文件

- `/docs/prompts/analyze_prompt.md` - AI分析提示词模板

### 修改时间

2025-12-29 18:00

### 修改者

Claude (基于用户反馈)

---

## 后续优化方向

1. 可以考虑根据文章数量动态调整选题数量的系统提示
2. 添加更多的案例来训练AI理解"一文一选题"的原则
3. 考虑在代码层面做验证：检测是否有重复引用同一篇文章的情况


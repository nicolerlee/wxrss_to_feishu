# é£ä¹¦æ¶ˆæ¯å¡ç‰‡ä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

æœ¬é¡¹ç›®å·²å‡çº§ä¸ºä½¿ç”¨**é£ä¹¦æ¶ˆæ¯å¡ç‰‡**ï¼ˆInteractive Cardï¼‰æ ¼å¼æ¨é€æ—¥æŠ¥ï¼Œç›¸æ¯”ä¹‹å‰çš„å¯Œæ–‡æœ¬æ ¼å¼ï¼Œå¡ç‰‡æ¶ˆæ¯å…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š

- âœ¨ **è§†è§‰æ•ˆæœæ›´ä½³**ï¼šç»“æ„åŒ–å¸ƒå±€ï¼Œå±‚æ¬¡åˆ†æ˜
- ğŸ“± **äº¤äº’æ€§æ›´å¼º**ï¼šæ”¯æŒæŒ‰é’®ã€é“¾æ¥ç­‰äº¤äº’å…ƒç´ 
- ğŸ¨ **ä¸»é¢˜ä¸°å¯Œ**ï¼šæ”¯æŒå¤šç§é¢œè‰²ä¸»é¢˜
- ğŸ“Š **ä¿¡æ¯å¯†åº¦æ›´é«˜**ï¼šæ›´å¥½çš„ä¿¡æ¯ç»„ç»‡æ–¹å¼

## æ¶ˆæ¯å¡ç‰‡æ ¼å¼è¯´æ˜

### åŸºæœ¬ç»“æ„

é£ä¹¦æ¶ˆæ¯å¡ç‰‡ä½¿ç”¨ **JSON Schema 2.0** æ ¼å¼ï¼ŒåŸºæœ¬ç»“æ„å¦‚ä¸‹ï¼š

```json
{
  "schema": "2.0",
  "header": {
    "title": {
      "tag": "plain_text",
      "content": "å¡ç‰‡æ ‡é¢˜"
    },
    "template": "blue"  // ä¸»é¢˜é¢œè‰²ï¼šblue, red, green, yellowç­‰
  },
  "elements": [
    // å¡ç‰‡å†…å®¹å…ƒç´ æ•°ç»„
  ]
}
```

### æ”¯æŒçš„å…ƒç´ ç±»å‹

#### 1. æ–‡æœ¬å†…å®¹ï¼ˆdiv + lark_mdï¼‰

æ”¯æŒ Markdown æ ¼å¼çš„æ–‡æœ¬ï¼š

```json
{
  "tag": "div",
  "text": {
    "tag": "lark_md",
    "content": "**ç²—ä½“æ–‡æœ¬**\n*æ–œä½“æ–‡æœ¬*\n[é“¾æ¥æ–‡æœ¬](https://example.com)"
  }
}
```

#### 2. çº¯æ–‡æœ¬ï¼ˆdiv + plain_textï¼‰

ä¸æ”¯æŒæ ¼å¼åŒ–çš„çº¯æ–‡æœ¬ï¼š

```json
{
  "tag": "div",
  "text": {
    "tag": "plain_text",
    "content": "è¿™æ˜¯çº¯æ–‡æœ¬å†…å®¹"
  }
}
```

#### 3. åˆ†å‰²çº¿ï¼ˆhrï¼‰

ç”¨äºåˆ†éš”ä¸åŒçš„å†…å®¹åŒºå—ï¼š

```json
{
  "tag": "hr"
}
```

### Markdown è¯­æ³•æ”¯æŒ

åœ¨ `lark_md` ç±»å‹çš„æ–‡æœ¬ä¸­ï¼Œæ”¯æŒä»¥ä¸‹ Markdown è¯­æ³•ï¼š

| è¯­æ³• | æ•ˆæœ |
|------|------|
| `**æ–‡æœ¬**` | **ç²—ä½“** |
| `*æ–‡æœ¬*` | *æ–œä½“* |
| `[æ–‡æœ¬](é“¾æ¥)` | è¶…é“¾æ¥ |
| `\n` | æ¢è¡Œ |
| `â€¢ æ–‡æœ¬` | æ— åºåˆ—è¡¨ |
| `âœ“ æ–‡æœ¬` | å‹¾é€‰ç¬¦å· |

## æˆ‘ä»¬çš„å¡ç‰‡è®¾è®¡

### å¡ç‰‡ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¤– AIé€‰é¢˜æ—¥æŠ¥ - 2025-12-29         â”‚  â† Headerï¼ˆè“è‰²ä¸»é¢˜ï¼‰
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“Š ä»Šæ—¥æ¦‚è§ˆ                         â”‚
â”‚ â€¢ åˆ†ææ–‡ç« æ•°: 15                    â”‚
â”‚ â€¢ è®¢é˜…è´¦å·æ•°: 8                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â† åˆ†å‰²çº¿
â”‚ ğŸ’¡ é€‰é¢˜çµæ„Ÿ                         â”‚
â”‚                                     â”‚
â”‚ 1. é€‰é¢˜æ ‡é¢˜                         â”‚
â”‚ ğŸ“ è§’åº¦: ...                        â”‚
â”‚ ğŸ¯ ç›®æ ‡: ...                        â”‚
â”‚ ğŸ’ ä»·å€¼: ...                        â”‚
â”‚ ğŸ“š å‚è€ƒæ–‡ç« : [é“¾æ¥]                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â† åˆ†å‰²çº¿
â”‚ ğŸ“š æ·±åº¦é˜…è¯»æ¨è                     â”‚
â”‚                                     â”‚
â”‚ 1. [æ–‡ç« æ ‡é¢˜](é“¾æ¥)                â”‚
â”‚ ğŸ‘¤ ä½œè€…: ... | â­ è¯„åˆ†: 9.2        â”‚
â”‚ ğŸ’¬ æ¨èç†ç”±: ...                   â”‚
â”‚ ğŸ’¡ æ ¸å¿ƒä»·å€¼: ...                   â”‚
â”‚ âœ… ç¬¦åˆæ ‡å‡†:                       â”‚
â”‚   âœ“ æ ‡å‡†1                          â”‚
â”‚   âœ“ æ ‡å‡†2                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â† åˆ†å‰²çº¿
â”‚ ğŸ”¥ æœ¬å‘¨çƒ­ç‚¹è¯é¢˜                     â”‚
â”‚                                     â”‚
â”‚ 1. è¯é¢˜åç§°                         â”‚
â”‚ ğŸ”¥ çƒ­åº¦: æé«˜ | ğŸ’¬ è®¨è®ºæ¬¡æ•°: 28    â”‚
â”‚ ğŸ“Š åˆ†æ: ...                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â† åˆ†å‰²çº¿
â”‚ ğŸ“… ç”Ÿæˆæ—¶é—´: 2025-12-29 10:30:00   â”‚
â”‚ ğŸ¤– ç”±AIè‡ªåŠ¨ç”Ÿæˆ                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä»£ç å®ç°

æ ¸å¿ƒå‡½æ•°åœ¨ `feishu_pusher.py` ä¸­ï¼š

```python
def format_ai_report_to_feishu_card(report):
    """
    å°†AIåˆ†ææŠ¥å‘Šæ ¼å¼åŒ–ä¸ºé£ä¹¦æ¶ˆæ¯å¡ç‰‡æ ¼å¼
    
    å‚æ•°:
        report: AIåˆ†ææŠ¥å‘Š (dict)
    
    è¿”å›:
        é£ä¹¦æ¶ˆæ¯å¡ç‰‡å†…å®¹ (JSONå­—ç¬¦ä¸²)
    """
    # æ„å»ºå¡ç‰‡ç»“æ„
    card = {
        "schema": "2.0",
        "header": {
            "title": {
                "tag": "plain_text",
                "content": f"ğŸ¤– AIé€‰é¢˜æ—¥æŠ¥ - {date}"
            },
            "template": "blue"
        },
        "elements": []
    }
    
    # æ·»åŠ å„ä¸ªéƒ¨åˆ†çš„å†…å®¹
    # ...
    
    return json.dumps(card, ensure_ascii=False)
```

## API è°ƒç”¨è¯´æ˜

### å‘é€æ¶ˆæ¯å¡ç‰‡

```python
# 1. è·å– tenant_access_token
token = get_tenant_access_token(app_id, app_secret)

# 2. æ ¼å¼åŒ–æŠ¥å‘Šä¸ºå¡ç‰‡
content = format_ai_report_to_feishu_card(report)

# 3. å‘é€æ¶ˆæ¯ï¼ˆä½¿ç”¨ interactive ç±»å‹ï¼‰
send_message_to_group(token, chat_id, "interactive", content)
```

### API è¯·æ±‚å‚æ•°

```json
{
  "receive_id": "oc_xxx",           // ç¾¤ID
  "msg_type": "interactive",        // æ¶ˆæ¯ç±»å‹å¿…é¡»æ˜¯ interactive
  "content": "{...}"                // å¡ç‰‡JSONå­—ç¬¦ä¸²
}
```

### API è¯·æ±‚å¤´

```
Authorization: Bearer {tenant_access_token}
Content-Type: application/json; charset=utf-8
```

## æµ‹è¯•å’Œè°ƒè¯•

### 1. æŸ¥çœ‹å®Œæ•´çš„å¡ç‰‡JSON

å‚è€ƒ `docs/feishu_card_example.json` æŸ¥çœ‹å®Œæ•´çš„å¡ç‰‡ç»“æ„ç¤ºä¾‹ã€‚

### 2. æœ¬åœ°æµ‹è¯•

è¿è¡Œä¸»ç¨‹åºæµ‹è¯•ï¼š

```bash
python main.py
```

### 3. è°ƒè¯•æŠ€å·§

å¦‚æœå¡ç‰‡æ˜¾ç¤ºå¼‚å¸¸ï¼Œæ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š

1. **JSONæ ¼å¼**ï¼šç¡®ä¿JSONæ ¼å¼æ­£ç¡®ï¼Œæ— è¯­æ³•é”™è¯¯
2. **msg_type**ï¼šå¿…é¡»è®¾ç½®ä¸º `"interactive"`
3. **Markdownè¯­æ³•**ï¼šç¡®ä¿ Markdown è¯­æ³•æ­£ç¡®
4. **é“¾æ¥æ ¼å¼**ï¼šç¡®ä¿é“¾æ¥ä½¿ç”¨ `[æ–‡æœ¬](URL)` æ ¼å¼
5. **æ¢è¡Œç¬¦**ï¼šä½¿ç”¨ `\n` è€Œä¸æ˜¯å®é™…æ¢è¡Œ

### 4. å¸¸è§é”™è¯¯

| é”™è¯¯ä»£ç  | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|---------|------|---------|
| 1248 | å¡ç‰‡JSONæ ¼å¼é”™è¯¯ | æ£€æŸ¥JSONè¯­æ³• |
| 1249 | msg_type ä¸æ­£ç¡® | æ”¹ä¸º "interactive" |
| 99991663 | ç¼ºå°‘å¿…è¦æƒé™ | åœ¨é£ä¹¦åå°æ·»åŠ æ¶ˆæ¯æƒé™ |

## è‡ªå®šä¹‰å¡ç‰‡

### ä¿®æ”¹ä¸»é¢˜é¢œè‰²

åœ¨ `format_ai_report_to_feishu_card` å‡½æ•°ä¸­ä¿®æ”¹ `template` å€¼ï¼š

```python
"header": {
    "title": {...},
    "template": "red"  # blue, red, green, yellow, orange, purple, wathet, carmine, violet, indigo
}
```

### æ·»åŠ æ–°çš„å†…å®¹åŒºå—

åœ¨ `elements` æ•°ç»„ä¸­æ·»åŠ æ–°å…ƒç´ ï¼š

```python
card["elements"].append({
    "tag": "div",
    "text": {
        "tag": "lark_md",
        "content": "**ä½ çš„è‡ªå®šä¹‰å†…å®¹**\nè¿™é‡Œå¯ä»¥å†™ä»»ä½• Markdown æ ¼å¼çš„æ–‡æœ¬"
    }
})
```

### æ·»åŠ æŒ‰é’®ï¼ˆå¯é€‰ï¼‰

æœªæ¥å¯ä»¥æ·»åŠ äº¤äº’æŒ‰é’®ï¼š

```python
card["elements"].append({
    "tag": "action",
    "actions": [{
        "tag": "button",
        "text": {
            "tag": "plain_text",
            "content": "æŸ¥çœ‹è¯¦æƒ…"
        },
        "type": "primary",
        "url": "https://example.com/detail"
    }]
})
```

## å‚è€ƒèµ„æ–™

- ğŸ“– [é£ä¹¦æ¶ˆæ¯å¡ç‰‡æ­å»ºæŒ‡å—](https://open.feishu.cn/document/ukTMukTMukTM/uYjNwUjL2YDM14iN2ATN)
- ğŸ“– [æ¶ˆæ¯å¡ç‰‡è®¾è®¡è§„èŒƒ](https://open.feishu.cn/document/ukTMukTMukTM/uAzMwUjLwMDM14CMzATN)
- ğŸ“– [å‘é€æ¶ˆæ¯API](https://open.feishu.cn/document/uAjLw4CM/ukTMukTMukTM/reference/im-v1/message/create)
- ğŸ¨ [å¡ç‰‡æ­å»ºå·¥å…·](https://open.feishu.cn/tool/cardbuilder)

## å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆè¦ä»å¯Œæ–‡æœ¬æ”¹ä¸ºå¡ç‰‡ï¼Ÿ

A: å¡ç‰‡æ¶ˆæ¯å…·æœ‰æ›´å¥½çš„è§†è§‰æ•ˆæœå’Œç»“æ„åŒ–å±•ç¤ºï¼Œç”¨æˆ·ä½“éªŒæ›´ä½³ã€‚

### Q2: æ—§çš„å¯Œæ–‡æœ¬æ ¼å¼è¿˜èƒ½ç”¨å—ï¼Ÿ

A: å¯ä»¥ï¼Œä½†å»ºè®®ä½¿ç”¨æ–°çš„å¡ç‰‡æ ¼å¼ã€‚å¦‚éœ€ä½¿ç”¨æ—§æ ¼å¼ï¼Œå¯ä»¥è‡ªè¡Œä¿®æ”¹ä»£ç ã€‚

### Q3: å¦‚ä½•åœ¨å¡ç‰‡ä¸­æ·»åŠ å›¾ç‰‡ï¼Ÿ

A: å¯ä»¥ä½¿ç”¨ `img` å…ƒç´ ï¼Œå‚è€ƒé£ä¹¦å®˜æ–¹æ–‡æ¡£ã€‚

### Q4: å¡ç‰‡å†…å®¹æœ‰é•¿åº¦é™åˆ¶å—ï¼Ÿ

A: æœ‰ï¼Œå•ä¸ªå¡ç‰‡JSONå¤§å°ä¸èƒ½è¶…è¿‡ 30KBã€‚å¦‚æœå†…å®¹è¿‡å¤šï¼Œå»ºè®®åˆ†æ®µæˆ–ç²¾ç®€ã€‚

---

**æ›´æ–°æ—¥æœŸ**: 2025-12-29  
**ç‰ˆæœ¬**: v2.0

